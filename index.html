<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digg - The front page of the internet with superpowers</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .logo {
            width: 120px;
            margin-bottom: 60px;
        }

        .digg-container {
            margin-bottom: 80px;
            position: relative;
            width: 90px;
            height: 100px;
            cursor: pointer;
	    transition: transform 0.3s ease;
        }

	.digg-container:hover {
	    transform: translateY(-3px);
	}

.digg-container.hover-active .digg-glow {
    opacity: 0.6;
    clip-path: none;
    z-index: 0;
}

.digg-container.hover-active .digg-box {
    animation: bounce 0.5s ease forwards;
}


        /* This is the main yellow box with the gradient */
        .digg-box {
            background: radial-gradient(circle at center 33%, rgba(255,255,255,1) 20%, rgba(254,233,162,1) 50%);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0px;
            width: 100%;
            height: 100%;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .counter {
	    font-family: 'Inter', sans-serif;
            color: #000;
            font-size: 24px;
            font-weight: 500;
            line-height: 28px;
            margin-top: 13px;
	    margin-bottom: 4px;
	    display: flex; *
	    justify-content: center;
            align-items: center;
        }

        .digit-roller {
            width: 22px;
            height: 28px;
            margin: 0 -3px; /* Tighten spacing between digits */
            position: relative;
            overflow: hidden;
            background-color: var(--digg-yellow);
        }

        /* The fixed digit that's shown */
        .current-digit {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: 500;
            color: #000; 
            transition: transform 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        /* The new digit that rolls in */
        .new-digit {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: 500;
            color: #000;
            transform: translateY(-100%);
            transition: transform 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        /* Animation classes */
        .animate-current {
            transform: translateY(100%);
        }

        .animate-new {
            transform: translateY(0);
        }

        .digg-button-container {
            width: 100%;
            margin-bottom: -8px;
        }
        
        .digg-button-image {
            width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        .digg-container:hover .digg-button-image {
            animation: bounce 0.5s ease;
        }

        .digg-glow {
            position: absolute;
            top: -15px;
            left: -15px;
            right: -15px;
            bottom: -15px;
            border-radius: 24px;
            background: linear-gradient(90deg, rgba(255, 0, 212, 0.8), rgba(0, 179, 255, 0.8), rgba(0, 240, 184, 0.8), rgba(255, 0, 212, 0.8));
            background-size: 300% 50%;
            animation: gradient-animation 4s ease infinite;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
            filter: blur(45px);
        }

        .digg-container:hover .digg-box {
	    animation: bounce 0.5s ease forwards;
	}
        
        .digg-container:hover .digg-glow {
            opacity: 0.6;
        }
        
        .digg-container:hover .digg-button {
            animation: bounce 0.5s ease;
        }

        h1 {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.2;
            max-width: 800px;
        }

        .subtitle {
            font-size: 18px;
            margin-bottom: 50px;
            text-align: center;
        }

        .email-form {
            position: relative;
            width: 100%;
            max-width: 550px;
        }

        .email-input {
            width: 100%;
            padding: 20px 30px;
            border-radius: 50px;
            border: 1px solid #15141d; 
            background-color: #15141d;
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

	.email-input:focus ~ .signup-button {
	    background-color: #2064DC;
	    color: white;
	}

        .email-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .input-border {
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            border-radius: 55px;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
            border: 2px solid transparent;
            background: linear-gradient(90deg, #ff00d4, #00b3ff, #00f0b8, #ff00d4) border-box;
            background-size: 300% 100%;
            animation: gradient-animation 4s ease infinite;
            -webkit-mask: 
                linear-gradient(#fff 0 0) content-box,
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            box-shadow: 
                0 0 5px rgba(255, 0, 212, 0.7),
                0 0 8px rgba(0, 179, 255, 0.7),
                0 0 10px rgba(0, 240, 184, 0.7);
            filter: blur(1.5px);
        }

        .email-form:hover .input-border,
        .email-input:focus + .input-border {
            opacity: 1;
        }

        .signup-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.1);
            color: #73738b;
	    font-size: medium;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            z-index: 2;
            transition: background-color 0.3s ease;
        }

        .signup-button:hover {
	    background-color: #2064DC;
	    color: white;
        }

        @keyframes gradient-animation {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes bounce {
	    0% {
		transform: translateY(0);
	    }
	    40% {
		transform: translateY(-3px); /* Higher initial bounce */
	    }
	    60% {
		transform: translateY(-2px); /* Settles at final position */
	    }
	    80% {
		transform: translateY(-1px); /* Small rebound */
	    }
	    100% {
		transform: translateY(-2px); /* Final settled position */
	    }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 36px;
            }
            .subtitle {
                font-size: 16px;
            }

    .digg-glow {
        position: absolute;
        top: -20px;
        left: -20px;
        right: -20px;
        bottom: -20px;
        border-radius: 24px;
        z-index: 0;
        filter: blur(45px);
        /* Remove any overflow restrictions on parent containers for mobile */
        overflow: visible;
    }
    
    .digg-container {
        /* Ensure container allows overflow */
        overflow: visible;
        position: relative;
        z-index: 1; /* Ensure the container is above other content */
    }

        }

        @media (max-width: 480px) {
            h1 {
                font-size: 28px;
            }
            .email-input {
                padding: 16px 20px;
            }
            .signup-button {
                padding: 8px 16px;
            }
        }
    </style>
</head>
<body>
    <svg class="logo" width="188" height="100" viewBox="0 0 188 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_2_38)">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M28 0V24H0V76H48V0H28ZM28 60H20V40H28V60Z" fill="#FFFFFF"/>
            <path d="M76 24H56V76H76V24Z" fill="#FFFFFF"/>
            <path d="M56 0H76V16H56V0Z" fill="#FFFFFF"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M140 24V76H168V84H140V100H188V24H140ZM160 60V40H168V60H160Z" fill="#FFFFFF"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M84 76V24H132V100H84V84H112V76H84ZM104 40V60H112V40H104Z" fill="#FFFFFF"/>
        </g>
        <defs>
            <clipPath id="clip0_2_38">
                <rect width="188" height="100" fill="white"/>
            </clipPath>
        </defs>
    </svg>

    <!-- This is the yellow counter box with gradient -->
    <div class="digg-container">
        <div id="digg-card" class="digg-box">
            <div id="counter-container" class="counter">830</div>
            <div class="digg-button-container">
                <img src="CTA.png" alt="digg button" class="digg-button-image" />
            </div>
        </div>
        <div class="digg-glow"></div>
    </div>

    <h1>The front page of the internet – now with superpowers.</h1>
    <p class="subtitle">Sign up to get early access when invites go live.</p>

    <div class="email-form">
        <input type="email" class="email-input" placeholder="Add an email address">
        <div class="input-border"></div>
        <button class="signup-button">Sign up</button>
    </div>

    <script>

        function poll() {
    	    // Generate random polling interval between 1-5 seconds
	    const randomInterval = (Math.random() * 4 + 1) * 1000;

	    // Clear any existing timeout
	    if (pollTimeout) clearTimeout(pollTimeout);

	    // Set up the next poll
	    pollTimeout = setTimeout(() => {
	      fetch(COUNT_URL)
		.then(response => response.json())
		.then(data => {
		  // Only update if the count has changed
		  if (data.count !== count) {
		    updateCounter(data.count);
		  }
		  poll(); // Schedule next poll
		})
		.catch(error => {
		  console.error('Error polling count:', error);
		  poll(); // Try again even on error
		});
	  }, randomInterval);
	}

        // Function to poll for the current count
        function startPolling() {
          if (isPolling) return;
          isPolling = true;

          // Start the polling cycle
          poll();
        }

        // Digg Button Click Counter Animation
        let testMode = true;
        let COUNT_URL = 'https://w473mpjyh6.execute-api.us-east-2.amazonaws.com/prod/count';
        let INCREMENT_URL = 'https://w473mpjyh6.execute-api.us-east-2.amazonaws.com/prod/digg';
        let isPolling = false;
        let pollTimeout;
        let lastUpdatedTime = 0;
        const diggCard = document.getElementById('digg-card');
        const counterContainer = document.getElementById('counter-container');
        let isAnimating = false;
        let digitRollers = []; // Will store references to all digit rollers

        // Function to create a single digit display
        function createDigitRoller(digit, position) {
            const roller = document.createElement('div');
            roller.className = 'digit-roller';
            roller.dataset.position = position;
            roller.dataset.digit = digit;

            // Current visible digit
            const currentDigit = document.createElement('div');
            currentDigit.className = 'current-digit';
            currentDigit.textContent = digit;

            roller.appendChild(currentDigit);

            return roller;
        }

        // Initialize counter display
        function initializeCounter() {
            counterContainer.innerHTML = '';
            digitRollers = [];

            // Convert count to string and create a roller for each digit
            const countStr = count.toString();
            for (let i = 0; i < countStr.length; i++) {
                const digit = parseInt(countStr[i]);
                const roller = createDigitRoller(digit, i);
                counterContainer.appendChild(roller);
                digitRollers.push(roller);
            }
        }

        // Function to animate a single digit change
        function animateDigitChange(rollerElement, newDigit) {
            // Get current digit
            const currentDigitElement = rollerElement.querySelector('.current-digit');
            const currentDigit = parseInt(rollerElement.dataset.digit);

            // Create new digit element that will slide in from top
            const newDigitElement = document.createElement('div');
            newDigitElement.className = 'new-digit';
            newDigitElement.textContent = newDigit;

            // Add the new digit to the DOM
            rollerElement.appendChild(newDigitElement);

            // Force a reflow to ensure the new element is properly positioned above
            void rollerElement.offsetWidth;

            // Start the animation by adding classes
            currentDigitElement.classList.add('animate-current');
            newDigitElement.classList.add('animate-new');

            // After animation completes, clean up
            setTimeout(() => {
                // Update data attribute
                rollerElement.dataset.digit = newDigit;

                // Remove the old digit element and animation classes
                rollerElement.removeChild(currentDigitElement);
                newDigitElement.classList.remove('animate-new');

                // Make the new digit the current digit
                newDigitElement.className = 'current-digit';
            }, 500); // Match transition time in CSS
        }

        // Update counter to a new value with animation
        function updateCounter(newValue) {
            const newValueStr = newValue.toString();
            const oldValueStr = count.toString();

            // If number of digits changed, reinitialize the counter
            if (newValueStr.length !== oldValueStr.length) {
                count = newValue;
                initializeCounter();
                return;
            }

            // Update each digit that has changed
            for (let i = 0; i < newValueStr.length; i++) {
                const newDigit = parseInt(newValueStr[i]);
                const oldDigit = parseInt(oldValueStr[i]);

                if (newDigit !== oldDigit) {
                    // Get the digit roller for this position
                    const roller = digitRollers[i];

                    // Animate the change
                    animateDigitChange(roller, newDigit);
                }
            }

            // Update the current count
            count = newValue;
        }

        diggCard.addEventListener('click', function() {
          if (pollTimeout) clearTimeout(pollTimeout);
          pollTimeout = setTimeout(poll, 3000); // force a 3 second wait before polling after the first click

          // Only proceed if we're not already animating
          if (isAnimating) return;

          // Add pulse animation to the card immediately for feedback
          // diggCard.classList.add('pulse');
          isAnimating = true;

          // First, get the latest count from the server
          fetch(COUNT_URL)
            .then(response => response.json())
            .then(data => {
              const serverCount = data.count;

              // Use the server count if it's higher than our local count
              const currentCount = Math.max(count, serverCount);

              // Optimistic update (immediately show increment to feel responsive)
              const optimisticCount = currentCount + 1;
              updateCounter(optimisticCount);

              // Now send increment request to API
              return fetch(INCREMENT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
              });
            })
            .then(response => response.json())
            .then(data => {
              // Update with the real server count
              updateCounter(data.count);

              // Mark that this user has clicked in localStorage
              if (!testMode) {
                localStorage.setItem('digg_clicked', 'true');
              }

              // Reset animation state
              setTimeout(() => {
                diggCard.classList.remove('pulse');
                isAnimating = false;
              }, 100);
            })
            .catch(error => {
              console.error('Error with counter operations:', error);
              // Still reset animation even on error
              //diggCard.classList.remove('pulse');
              isAnimating = false;
            });
        });

    // Initialize on page load
    window.onload = function() {
        const diggCard = document.getElementById('digg-card');
        const counterContainer = document.getElementById('counter-container');

        // Fetch initial count
        fetch(COUNT_URL)
            .then(response => response.json())
            .then(data => {
                count = data.count;
                initializeCounter();

                // Start polling for updates
                startPolling();

                // Start typing animation
                // setTimeout(typeText, 500);
            })
            .catch(error => {
                console.error('Error fetching initial count:', error);
                // Initialize with default value on error
                initializeCounter();
                // setTimeout(typeText, 500);
            });
    };


        // Email signup functionality
        document.querySelector('.signup-button').addEventListener('click', function() {
            const emailInput = document.querySelector('.email-input');
            const email = emailInput.value;
            const button = this;
            const originalButtonText = button.textContent;

            if (validateEmail(email)) {
                // Disable button and show loading state
                button.disabled = true;
                button.textContent = 'Submitting...';

                const clientData = {
                    email: email,
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    screenWidth: window.screen.width,
                    screenHeight: window.screen.height,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    referrer: document.referrer || 'direct',
                };

                console.log(clientData);
                // Send to API Gateway Lambda
                fetch('https://2t2rkg32gc.execute-api.us-east-2.amazonaws.com/prod/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ clientData })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Success message
                        const signupContainer = emailInput.closest('.signup-container');
                        const formContainer = emailInput.closest('form') || emailInput.closest('div');

                        // Hide the form
                        if (formContainer) formContainer.style.display = 'none';

                        // Create and show success message
                        const successMsg = document.createElement('div');
                        successMsg.className = 'success-message';
                        successMsg.innerHTML = '<p>Thank you for signing up! We will be in touch soon.</p>';

                        // Add success message to the page
                        if (signupContainer) {
                            signupContainer.appendChild(successMsg);
                        } else {
                            formContainer.parentNode.appendChild(successMsg);
                        }
                    } else {
                        // Error from server
                        alert(data.message || 'Something went wrong. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('There was an error signing up. Please try again.');
                })
                .finally(() => {
                    // Reset button state
                    button.disabled = false;
                    button.textContent = originalButtonText;
                });
            } else {
                alert('Please enter a valid email address.');
            }
        });

        function validateEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }

        document.addEventListener('DOMContentLoaded', function() {
            const emailInput = document.querySelector('.email-input');
            const inputBorder = document.querySelector('.input-border');
            const emailForm = document.querySelector('.email-form');
            
            // Show border on input focus
            emailInput.addEventListener('focus', function() {
                inputBorder.style.opacity = '1';
            });
            
            // Hide border when focus is lost and not hovering
            emailInput.addEventListener('blur', function() {
                if (!emailForm.matches(':hover')) {
                    inputBorder.style.opacity = '0';
                }
            });
            
            // Show border on form hover
            emailForm.addEventListener('mouseenter', function() {
                inputBorder.style.opacity = '1';
            });
            
            // Hide border on form mouse leave, but only if input is not focused
            emailForm.addEventListener('mouseleave', function() {
                if (document.activeElement !== emailInput) {
                    inputBorder.style.opacity = '0';
                }
            });
        });

const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

if (isMobile) {
  const diggContainer = document.querySelector('.digg-container');
  
  // Add touch event listeners for mobile
  diggContainer.addEventListener('touchstart', function(e) {
    // Add hover classes to simulate hover state
    diggContainer.classList.add('hover-active');
    
    // Prevent the glow from being clipped
    const diggGlow = diggContainer.querySelector('.digg-glow');
    if (diggGlow) {
      diggGlow.style.clipPath = 'none';
      diggGlow.style.opacity = '0.6';
    }
    
    // Trigger the bounce animation
    const diggBox = diggContainer.querySelector('.digg-box');
    if (diggBox) {
      diggBox.style.animation = 'bounce 0.5s ease forwards';
    }
    
    // Allow the click event to still fire
    // This is important since your click handler contains important logic
  });
  
  // Remove hover state after a delay
  diggContainer.addEventListener('touchend', function() {
    // Set a timeout to remove the hover state
    setTimeout(function() {
      diggContainer.classList.remove('hover-active');
      
      const diggGlow = diggContainer.querySelector('.digg-glow');
      if (diggGlow) {
        diggGlow.style.opacity = '0';
      }
      
      const diggBox = diggContainer.querySelector('.digg-box');
      if (diggBox) {
        diggBox.style.animation = '';
      }
    }, 3000); // Keep hover effect for 1 second after tap ends
  });
}


    </script>
</body>
</html>
